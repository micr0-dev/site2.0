<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#16a34a" />
    <!-- Primary Meta Tags -->
    <title>I am [age] — How climate change will shape my life</title>
    <meta name="title" content="I am [age] — How climate change will shape my life">
    <meta name="description"
        content="An interactive overview of how climate change will shape your lifetime. Real data, accessible insights, and a clear look at the future.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://micr0.dev/climate/">
    <meta property="og:title" content="I am [age] — How climate change will shape my life">
    <meta property="og:description"
        content="An interactive overview of how climate change will shape your lifetime. Real data, accessible insights, and a clear look at the future.">
    <meta property="og:image" content="https://micr0.dev/climate/social.png">

    <!-- Twitter / X -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://micr0.dev/climate/">
    <meta name="twitter:title" content="I am [age] — How climate change will shape my life">
    <meta name="twitter:description"
        content="An interactive overview of how climate change will shape your lifetime. Real data, accessible insights, and a clear look at the future.">
    <meta name="twitter:image" content="https://micr0.dev/climate/social.png">

    <!-- Favicon + icons -->
    <link rel="icon" href="/favicon.ico">

    <!-- Extra SEO -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#16a34a">
    <link rel="canonical" href="https://micr0.dev/climate/">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --bg: #ffffff;
            --fg: #111;
            --muted: #666;
            --line: #e5e7eb;
            --accent: hsl(150 60% 40%);
            /* will morph to brown on scroll */
            --accent-2: hsl(32 85% 52%);
            /* warm highlight */
            --soft: #f7f7f8;

            /* Age dial sizing */
            --dial-h: 96px;
            /* smaller vertical footprint */
            --item-h: 32px;
            /* number height */
            --item-gap: 12px;
            /* spacing between numbers */
            --radius: 12px;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"
        }

        h1,
        h2,
        h3 {
            font-weight: 800;
            letter-spacing: -.02em;
            margin: 0 0 .5rem
        }

        h1 {
            font-size: clamp(2rem, 4vw, 3.2rem);
            line-height: 1.15
        }

        h2 {
            font-size: clamp(1.5rem, 2.5vw, 2rem)
        }

        h3 {
            font-size: clamp(1.1rem, 2vw, 1.35rem)
        }

        p {
            line-height: 1.65
        }

        .muted {
            color: var(--muted)
        }

        .tiny {
            font-size: .9rem
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1rem 1.25rem
        }

        /* Simple hero (no sticky) */
        .hero {
            padding: 2.25rem 0 1rem
        }

        .kicker {
            display: inline-block;
            padding: .35rem .7rem;
            border: 1px solid var(--line);
            border-radius: 999px;
            background: var(--soft);
            font-weight: 600
        }

        /* Age inline dial */
        .age-inline {
            display: inline-flex;
            gap: .6rem;
            align-items: center;
            white-space: nowrap;
            vertical-align: baseline
        }

        .dial {
            --item-total: calc(var(--item-h) + var(--item-gap));
            height: var(--dial-h);
            width: 88px;
            /* slimmer so headline keeps one line more often */
            border: 1px solid var(--line);
            border-radius: 26px;
            background: var(--bg);
            position: relative;
            overflow: auto;
            scroll-snap-type: y mandatory;
            padding-block: calc(var(--dial-h)/2 - var(--item-total)/2);
            scrollbar-width: none;
        }

        .dial::-webkit-scrollbar {
            display: none
        }

        .dial-track {
            display: flex;
            flex-direction: column;
            align-items: stretch
        }

        .dial-item {
            height: var(--item-h);
            margin-block: calc(var(--item-gap)/2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-variant-numeric: tabular-nums;
            scroll-snap-align: center;
            user-select: none;
            transition: transform .15s ease, opacity .15s ease, font-weight .15s ease, background-color .15s ease;
            border-radius: 10px;
            padding-inline: .25rem;
        }

        .dial-item[data-selected="true"] {
            font-weight: 800 !important;
            transform: scale(1.1);
        }

        .dial-item[data-near="true"] {
            font-weight: 600;
            opacity: .85
        }

        .dial-item[data-near="false"] {
            font-weight: 600;
            opacity: .5
        }

        /* Timeline */
        .timeline {
            position: relative
        }

        .timeline::before {
            content: "";
            position: absolute;
            left: calc(50% - .5px);
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--line)
        }

        @media (max-width:880px) {
            .timeline::before {
                left: 1rem
            }
        }

        .t-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2.5rem;
            align-items: start;
            padding: 3rem 0;
            position: relative
        }

        .t-year {
            position: sticky;
            top: 1.25rem;
            align-self: start
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            font-weight: 700;
            border: 1px solid var(--line);
            padding: .35rem .7rem;
            border-radius: 999px;
            background: var(--bg)
        }

        .dot {
            width: .65rem;
            height: .65rem;
            background: var(--accent);
            border-radius: 999px;
            box-shadow: 0 0 0 4px color-mix(in srgb, var(--accent) 18%, transparent)
        }

        .panel {
            border: 1px solid var(--line);
            border-radius: 20px;
            padding: 1.35rem;
            background: var(--bg);
            box-shadow: 0 5px 30px rgba(0, 0, 0, .04)
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: .5rem;
            margin: .75rem 0
        }

        .chip {
            border: 1px solid var(--line);
            border-radius: 999px;
            padding: .25rem .6rem;
            font-size: .9rem
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.35rem
        }

        /* more space between cards */
        .col-6 {
            grid-column: span 6
        }

        .col-4 {
            grid-column: span 4
        }

        .col-8 {
            grid-column: span 8
        }

        .col-12 {
            grid-column: 1/-1
        }

        @media (max-width:880px) {
            .grid {
                grid-template-columns: repeat(6, 1fr)
            }

            .col-6,
            .col-4,
            .col-8 {
                grid-column: 1/-1
            }
        }

        .card {
            border: 1px solid var(--line);
            border-radius: 16px;
            padding: 1rem;
            background: var(--soft)
        }

        .card h3 {
            margin-bottom: .25rem
        }

        .eyebrow {
            font-size: .8rem;
            font-weight: 700;
            color: var(--muted);
            letter-spacing: .08em;
            text-transform: uppercase
        }

        /* Charts */
        .chart {
            width: 100%;
            aspect-ratio: 16/9;
            background: var(--bg);
            border: 1px dashed var(--line);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding: .5rem
        }

        .chart.loading::after {
            content: "";
            position: absolute;
            left: 50%;
            top: 50%;
            width: 28px;
            height: 28px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 3px solid var(--line);
            border-top-color: var(--accent);
            animation: spin .8s linear infinite;
            pointer-events: none;
        }

        .chart.loading::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(0deg,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, .65) 50%,
                    rgba(255, 255, 255, 0) 100%);
            opacity: .6;
            pointer-events: none;
        }

        @keyframes spin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .chart.loading::after {
                animation: none;
            }
        }

        @media print {

            .chart.loading::before,
            .chart.loading::after {
                display: none !important;
            }
        }

        .chart svg {
            width: 100%;
            height: 100%
        }

        .legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin-top: .5rem
        }

        .swatch {
            display: inline-flex;
            align-items: center;
            gap: .35rem
        }

        .key {
            width: .9rem;
            height: .9rem;
            border-radius: 2px;
            background: var(--accent)
        }

        .key.alt {
            background: var(--accent-2)
        }

        .note {
            font-size: .9rem;
            color: var(--muted)
        }

        /* Footer & socials */
        .footer {
            padding: 3rem 0;
            border-top: 1px solid var(--line)
        }

        .footgrid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem
        }

        @media (max-width:880px) {
            .footgrid {
                grid-template-columns: 1fr
            }
        }

        .socials a {
            color: var(--accent);
            text-decoration: none;
            border-bottom: 1px solid color-mix(in srgb, var(--accent) 30%, transparent);
            padding-bottom: 1px
        }

        .socials a:hover {
            border-color: var(--accent)
        }

        /* Reveal on scroll */
        .reveal {
            opacity: 0;
            transform: translateY(12px);
            transition: opacity .9s ease, transform .9s ease
        }

        .reveal.visible {
            opacity: 1;
            transform: none
        }

        /* Little skull at the very end */
        .finis {
            display: flex;
            gap: .6rem;
            align-items: center;
            justify-content: center;
            color: #8b5e3c
        }

        /* ---------- New: nice buttons, tabs, sources grid, toasts ---------- */
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: .6rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            padding: .55rem .9rem;
            border-radius: 999px;
            border: 1px solid color-mix(in srgb, var(--accent) 55%, var(--line));
            background: color-mix(in srgb, var(--accent) 12%, #fff);
            color: var(--fg);
            font-weight: 700;
            cursor: pointer;
            transition: transform .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, .06);
            background: color-mix(in srgb, var(--accent) 18%, #fff);
        }

        .btn.secondary {
            background: #fff;
            border-color: var(--line);
        }

        .btn i {
            font-size: 1rem;
        }

        .tabs {
            display: inline-flex;
            gap: .4rem;
            border: 1px solid var(--line);
            padding: .35rem;
            border-radius: 999px;
            background: #fff;
        }

        .tab {
            appearance: none;
            border: 0;
            background: transparent;
            padding: .45rem .8rem;
            border-radius: 999px;
            font-weight: 700;
            cursor: pointer;
            color: var(--muted);
            outline: none;
        }

        .tab[aria-selected="true"] {
            background: color-mix(in srgb, var(--accent) 15%, #fff);
            color: var(--fg);
            box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--accent) 35%, transparent);
        }

        .tab-panels>[role="tabpanel"] {
            margin-top: 1rem;
        }

        .source-list {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: .8rem;
        }

        @media (max-width: 700px) {
            .source-list {
                grid-template-columns: 1fr;
            }
        }

        .source-card {
            display: flex;
            align-items: start;
            gap: .75rem;
            padding: .9rem;
            border: 1px solid var(--line);
            border-radius: 14px;
            background: #fff;
            text-decoration: none;
            color: inherit;
            transition: background .12s ease, transform .12s ease, box-shadow .12s ease, border-color .12s ease;
        }

        .source-card:hover {
            background: color-mix(in srgb, var(--accent) 8%, #fff);
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, .06);
            border-color: color-mix(in srgb, var(--accent) 35%, var(--line));
        }

        .source-card i {
            color: var(--accent);
            margin-top: .15rem;
        }

        .source-title {
            font-weight: 800;
        }

        .source-desc {
            color: var(--muted);
            font-size: .9rem;
        }

        .toast {
            position: fixed;
            left: 50%;
            bottom: 20px;
            transform: translateX(-50%);
            background: #111;
            color: #fff;
            padding: .6rem .9rem;
            border-radius: 999px;
            font-size: .9rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity .25s ease, transform .25s ease;
            z-index: 9999;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }

        @media print {

            .btn,
            .tabs,
            .socials,
            .source-desc {
                display: none !important;
            }

            .source-list {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 600px) {

            .dial-item {
                scale: 1.25;
                font-weight: 700 !important;
            }

            .dial-item[data-selected="true"] {
                font-weight: 900 !important;
                scale: 1.5;
            }
        }

        .finis {
            display: none !important;
        }

        .death-marker {
            position: relative;
            margin: 2rem 0;
        }

        .death-marker::before {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
        }

        .death-marker .label {
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border: 1px solid var(--line);
            border-radius: 999px;
            padding: .25rem .65rem;
            font-weight: 800;
            color: var(--muted);
            white-space: nowrap;
        }

        /* after-life rows: paint over the solid rail, redraw as dotted */
        .t-row.post-life::before {
            content: "";
            position: absolute;
            left: calc(50% - .5px);
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--bg);
            /* cover the solid line */
            z-index: 1;
        }

        .t-row.post-life::after {
            content: "";
            position: absolute;
            left: calc(50% - .5px);
            top: 0;
            bottom: 0;
            border-left: 1px dotted var(--line);
            z-index: 2;
        }

        @media (max-width:880px) {

            .t-row.post-life::before,
            .t-row.post-life::after {
                left: 1rem;
            }

            /* align to mobile rail */
        }

        .t-row.post-life.first-post::before,
        .t-row.post-life.first-post::after {
            top: calc(var(--death-offset, 0px) * -1);
            /* pull overlay up into the gap */
        }

        :root {
            --proj: #9ca3af;
            /* grey for projections */
        }

        /* legend square for projection */
        .key.proj {
            background: var(--proj);
        }

        /* dotted projection path */
        .chart .projection {
            stroke: var(--proj);
            stroke-dasharray: 6 6;
        }
    </style>
</head>

<body>
    <main class="container">
        <section class="hero">
            <h1>
                I am
                <span class="age-inline">
                    <span id="dial" class="dial" aria-label="Select your age (10 to 85)" role="listbox"></span>
                </span>
                . Here’s how climate change is likely to shape the rest of my life.
            </h1>
            <p class="muted tiny" style="margin-top:.5rem">Tip: scroll or flick the dial · press ↑/↓ with focus</p>
        </section>

        <section class="timeline" id="timeline">
            <!-- 2025s / Near-term -->
            <div class="t-row">
                <div class="t-year">
                    <span class="badge"><span class="dot"></span> <span>2025–2029</span></span>
                    <h2>Now through the late 2020s</h2>
                    <p class="muted">You’re <strong><span class="age-year" data-year="2025"></span></strong> today.</p>
                </div>
                <div class="panel reveal">
                    <div class="chips">
                        <span class="chip"><i class="fa-solid fa-temperature-high"></i> hotter baselines</span>
                        <span class="chip"><i class="fa-solid fa-house-crack"></i> insurance pullback</span>
                        <span class="chip"><i class="fa-solid fa-wheat-awn"></i> food price shocks</span>
                    </div>
                    <div class="grid">
                        <div class="col-6 card">
                            <h3>Heat & extremes are the new normal</h3>
                            <p>Recent years have been record-hot. Expect more “once-in-a-century” floods and heat domes
                                to show up as regular news. Cooling costs and lost outdoor time rise.</p>
                            <p class="note">Real-world data is below.</p>
                        </div>
                        <div class="col-6 card">
                            <h3>Insurance & risk shift</h3>
                            <p>Insurers raise rates or exit high-risk areas in many regions; mortgages and rents
                                increasingly reflect climate exposure.</p>
                        </div>
                        <div class="col-12 card">
                            <div class="eyebrow">Global temperature (NASA GISTEMP v4)</div>
                            <h3>Temperature anomalies vs 1951–1980</h3>
                            <div id="tempChart" class="chart" role="img"
                                aria-label="Line chart: global temperature anomaly, NASA GISTEMP v4, 1880–present (baseline 1951–1980).">
                            </div>
                            <div class="legend tiny">
                                <span class="swatch"><span class="key"></span> GISTEMP global annual</span>
                            </div>
                            <p class="note">Paris targets (1.5 °C/2.0 °C) are defined vs 1850–1900; GISTEMP’s baseline
                                is 1951–1980 (≈0.2–0.3 °C lower).</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2030s -->
            <div class="t-row">
                <div class="t-year">
                    <span class="badge"><span class="dot"></span> <span>2030s</span></span>
                    <h2>By the 2030s</h2>
                    <p class="muted">You’ll be about <strong><span class="age-year" data-year="2030"></span></strong> in
                        2030 and <strong><span class="age-year" data-year="2039"></span></strong> in 2039.</p>
                </div>
                <div class="panel reveal">
                    <div class="chips">
                        <span class="chip"><i class="fa-solid fa-person-walking-arrow-right"></i> migration
                            begins</span>
                        <span class="chip"><i class="fa-solid fa-sun"></i> dangerous heat days</span>
                        <span class="chip"><i class="fa-solid fa-bowl-food"></i> crop volatility</span>
                    </div>
                    <div class="grid">
                        <div class="col-6 card">
                            <h3>Permanent 1.5 °C breach risk</h3>
                            <p>Multi-year averages likely sit near or above 1.5 °C over pre-industrial, raising the odds
                                of compounding heat and humidity that strain public health and labor.</p>
                        </div>
                        <div class="col-6 card">
                            <h3>Coasts get louder</h3>
                            <p>“Nuisance” floods stack with storm surges. Ad-hoc relocations (“managed retreat”) start
                                in more places.</p>
                        </div>
                        <div class="col-12 card">
                            <div class="eyebrow">Global mean sea level (NASA/JPL)</div>
                            <h3>Sea level change since 1993 (mm)</h3>
                            <div id="slrChart" class="chart" role="img"
                                aria-label="Line chart: global mean sea level change since 1993 in millimeters, NASA/JPL MEaSUREs.">
                            </div>
                            <div class="legend tiny">
                                <span class="swatch"><span class="key"></span> Smoothed GMSL (GIA applied)</span>
                            </div>
                            <p class="note">Satellite altimetry record; seasonal signals removed (NASA MEaSUREs, Column
                                12).</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2040s -->
            <div class="t-row">
                <div class="t-year">
                    <span class="badge"><span class="dot"></span> <span>2040s</span></span>
                    <h2>The 2040s</h2>
                    <p class="muted">You’re roughly <strong><span class="age-year" data-year="2045"></span></strong> in
                        the middle of this decade.</p>
                </div>
                <div class="panel reveal">
                    <div class="chips">
                        <span class="chip"><i class="fa-solid fa-cloud-bolt"></i> compounding disasters</span>
                        <span class="chip"><i class="fa-solid fa-industry"></i> grid + supply shocks</span>
                        <span class="chip"><i class="fa-solid fa-people-group"></i> displacement scales up</span>
                    </div>
                    <div class="grid">
                        <div class="col-6 card">
                            <h3>Food & water stress bite</h3>
                            <p>Simultaneous crop failures become more common when heat and drought cluster. Prices
                                swing; rationing appears during bad years even in wealthy countries.</p>
                        </div>
                        <div class="col-6 card">
                            <h3>Smoke, heat, outages</h3>
                            <p>Wildfire smoke and extreme heat drive indoor summers in many regions. Energy and
                                logistics disruptions interrupt jobs, schooling, and care.</p>
                        </div>
                        <div class="col-12 card">
                            <div class="eyebrow">Mini dashboard, data-backed</div>
                            <!-- Tabs -->
                            <div class="tabs" role="tablist" aria-label="Mini dashboard tabs">
                                <button id="tab-co2" class="tab" role="tab" aria-selected="true"
                                    aria-controls="panel-co2"><i class="fa-solid fa-cloud-arrow-up"></i> Global
                                    CO₂</button>
                                <button id="tab-damage" class="tab" role="tab" aria-selected="false"
                                    aria-controls="panel-damage"><i class="fa-solid fa-coins"></i> Disaster
                                    damages</button>
                                <button id="tab-idp" class="tab" role="tab" aria-selected="false"
                                    aria-controls="panel-idp"><i class="fa-solid fa-person-walking-luggage"></i> New
                                    displacements</button>
                            </div>
                            <div class="tab-panels">
                                <div id="panel-co2" role="tabpanel" tabindex="0" aria-labelledby="tab-co2">
                                    <div id="co2Chart" class="chart"
                                        aria-label="Line chart: Global CO₂ emissions including land-use change (Global Carbon Project via Our World in Data).">
                                    </div>
                                    <p class="note">Source: Global Carbon Project via Our World in Data.</p>
                                </div>
                                <div id="panel-damage" role="tabpanel" tabindex="0" aria-labelledby="tab-damage" hidden>
                                    <div id="damageChart" class="chart"
                                        aria-label="Line chart: Global economic damages from natural disasters, EM-DAT via Our World in Data.">
                                    </div>
                                    <p class="note">Source: EM-DAT via Our World in Data (not inflation-adjusted).</p>
                                </div>
                                <div id="panel-idp" role="tabpanel" tabindex="0" aria-labelledby="tab-idp" hidden>
                                    <div id="idpChart" class="chart"
                                        aria-label="Line chart: Global new internal displacements from disasters (IDMC via World Bank / OWID).">
                                    </div>
                                    <p class="note">Source: IDMC via World Bank / Our World in Data.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 card" style="background:#fff4f4">
                            <h3><i class="fa-solid fa-children"></i> The hard question</h3>
                            <p><em>“If you have kids, they ask why you brought them into this world.”</em> You might not
                                have a good answer. That’s part of the honesty here: facing trade-offs between hope,
                                action, and responsibility—then doing the most good you can with clear eyes and a steady
                                hand.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2050s -->
            <div class="t-row">
                <div class="t-year">
                    <span class="badge"><span class="dot"></span> <span>2050s</span></span>
                    <h2>Mid-century</h2>
                    <p class="muted">You’re about <strong><span class="age-year" data-year="2050"></span></strong> in
                        2050.</p>
                </div>
                <div class="panel reveal">
                    <div class="chips">
                        <span class="chip"><i class="fa-solid fa-water"></i> higher baseline seas</span>
                        <span class="chip"><i class="fa-solid fa-fish"></i> reefs functionally gone</span>
                        <span class="chip"><i class="fa-solid fa-icicles"></i> ice loss accelerates</span>
                    </div>
                    <div class="grid">
                        <div class="col-6 card">
                            <h3>Coastal risk re-maps cities</h3>
                            <p>With multi-decadal sea-level rise, storm tides reach farther inland. Some districts are
                                protected by expensive barriers; others are abandoned.</p>
                        </div>
                        <div class="col-6 card">
                            <h3>Ecosystems flip</h3>
                            <p>Many coral reefs are gone; forests shift toward savanna in some regions. Fisheries,
                                tourism, and local food webs change permanently.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2060s–2070s -->
            <div class="t-row">
                <div class="t-year">
                    <span class="badge"><span class="dot"></span> <span>2060s–2070s</span></span>
                    <h2>Later life, higher stakes</h2>
                    <p class="muted">You’re roughly <strong><span class="age-year" data-year="2070"></span></strong> by
                        2070.</p>
                </div>
                <div class="panel reveal">
                    <div class="chips">
                        <span class="chip"><i class="fa-solid fa-arrows-rotate"></i> ocean circulation weaker</span>
                        <span class="chip"><i class="fa-solid fa-tractor"></i> adaptation limits</span>
                        <span class="chip"><i class="fa-solid fa-city"></i> managed retreat</span>
                    </div>
                    <div class="grid">
                        <div class="col-12 card">
                            <h3>Compounding risk world</h3>
                            <p>Heat, water, crops, coasts, ecosystems—multiple systems strain at once. Not everywhere,
                                not all the time, but often enough to define the decade.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2100 & finis -->
            <div class="t-row">
                <div class="t-year">
                    <span class="badge"><span class="dot"></span> <span>2100</span></span>
                    <h2>End-of-century horizon</h2>
                    <p class="muted">If you reach it, you’d be around <strong><span class="age-year"
                                data-year="2100"></span></strong>.</p>
                </div>
                <div class="panel reveal">
                    <div class="chips">
                        <span class="chip"><i class="fa-solid fa-mountain"></i> higher seas locked in</span>
                        <span class="chip"><i class="fa-solid fa-temperature-three-quarters"></i> 2–3 °C world
                            plausible</span>
                        <span class="chip"><i class="fa-solid fa-leaf"></i> tipping risks accumulate</span>
                    </div>
                    <div class="grid">
                        <div class="col-12 card">
                            <p>The direction is not in doubt; the scale depends on choices. Your world will differ from
                                the one you were born into—how much depends on what people do, together, starting now.
                            </p>
                        </div>
                        <div class="col-12 finis tiny"><i class="fa-solid fa-skull"></i> eventually, every timeline ends
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="footer">
            <div class="footgrid">
                <div>
                    <h3>What this is</h3>
                    <p>An interactive overview of likely life-scale climate impacts.
                        Charts use real datasets. Accessible without a science degree.</p>
                </div>
                <div>
                    <h3>Credible sources to explore</h3>
                    <div class="source-list tiny" aria-label="Key data sources">
                        <a class="source-card" href="https://data.giss.nasa.gov/gistemp/" target="_blank"
                            rel="noopener">
                            <i class="fa-solid fa-temperature-three-quarters"></i>
                            <div>
                                <div class="source-title">NASA GISTEMP v4</div>
                                <div class="source-desc">Global temperature anomalies & methodology</div>
                            </div>
                        </a>
                        <a class="source-card"
                            href="https://sealevel.nasa.gov/understanding-sea-level/key-indicators/global-mean-sea-level"
                            target="_blank" rel="noopener">
                            <i class="fa-solid fa-water"></i>
                            <div>
                                <div class="source-title">NASA/JPL Sea Level Change</div>
                                <div class="source-desc">Global mean sea level (altimetry)</div>
                            </div>
                        </a>
                        <a class="source-card" href="https://ourworldindata.org/co2-emissions" target="_blank"
                            rel="noopener">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <div>
                                <div class="source-title">Global Carbon Project (OWID)</div>
                                <div class="source-desc">CO₂ emissions incl. land-use change</div>
                            </div>
                        </a>
                        <a class="source-card" href="https://ourworldindata.org/natural-disasters" target="_blank"
                            rel="noopener">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                            <div>
                                <div class="source-title">EM-DAT & IDMC (OWID)</div>
                                <div class="source-desc">Disasters, damages & displacement</div>
                            </div>
                        </a>
                    </div>
                    <div class="btn-row" style="margin-top:1rem">
                        <button class="btn" id="shareBtn"><i class="fa-solid fa-share-nodes"></i>
                            Share</button>
                        <button class="btn secondary" id="printBtn"><i class="fa-solid fa-print"></i>
                            Print</button>

                    </div>
                </div>
            </div>
            <p class="tiny muted" style="margin-top:1rem">Built with plain HTML, CSS, and a touch of JS. No frameworks.
                Open Source as always. Sorry if this was grim.
            </p>

            <div class="socials tiny" style="margin-top:1rem">
                <strong>More from me:</strong>
                &nbsp; <a href="https://micr0.dev" target="blank" rel="noopener"><i class="fa-solid fa-link"></i>
                    micr0.dev</a>
                &nbsp; <a href="https://wetdry.world/@micr0" target="_blank" rel="me noopener"><i
                        class="fa-brands fa-mastodon"></i> Mastodon</a>
                &nbsp; <a href="https://github.com/micr0-dev/" target="_blank" rel="noopener"><i
                        class="fa-brands fa-github"></i> GitHub</a>
            </div>
        </section>
    </main>

    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

    <script>
        /* ---------- Config & helpers ---------- */
        const CURRENT_YEAR = 2025;
        const DEATH_AGE = 86;      // tweak if you want a different default
        const GENERATION = 30;     // years per generation (kids, grandkids)
        const timelineEl = document.getElementById('timeline');
        let deathMarkerEl = null;

        const nfCompact = new Intl.NumberFormat(undefined, { notation: 'compact', maximumFractionDigits: 1 });
        const nf0 = new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 });
        const nf1 = new Intl.NumberFormat(undefined, { maximumFractionDigits: 1 });
        const compact = v => nfCompact.format(v);
        const compactCurrency = v => '$' + nfCompact.format(v); // -> $16B, $250M, etc.

        function mkSVG(w = 800, h = 450) {
            const s = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            s.setAttribute('viewBox', `0 0 ${w} ${h}`); s.setAttribute('role', 'img'); return s;
        }
        function linePath(points) { return points.map((p, i) => (i ? 'L' : 'M') + p[0] + ',' + p[1]).join(' '); }
        function niceAxis(min, max, steps) {
            const span = max - min; const step = span / steps; const ticks = [];
            for (let i = 0; i <= steps; i++) ticks.push(min + i * step);
            return ticks;
        }
        function setAccentByScroll() {
            const scrollTop = window.scrollY;
            const docHeight = document.body.scrollHeight - window.innerHeight;
            const t = Math.min(1, Math.max(0, docHeight ? scrollTop / docHeight : 0));
            // green (h=150) -> brown (h=24)
            const h = 150 - (150 - 24) * t, s = 65 - 5 * t, l = 42 - 2 * t;
            document.documentElement.style.setProperty('--accent', `hsl(${h} ${s}% ${l}%)`);
            // warm complementary accent-2
            document.documentElement.style.setProperty('--accent-2', `hsl(${Math.max(0, h - 18)} 82% 52%)`);
        }

        /* ---------- Age dial (cover-flow style, compact) ---------- */
        const dialEl = document.getElementById('dial');
        const MIN_AGE = 10, MAX_AGE = 85, START_AGE = 18;
        const ITEM_H = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--item-h'));
        const ITEM_GAP = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--item-gap'));
        const ITEM_TOTAL = ITEM_H + ITEM_GAP;

        (function buildDial() {
            const track = document.createElement('div'); track.className = 'dial-track'; dialEl.appendChild(track);
            for (let a = MIN_AGE; a <= MAX_AGE; a++) {
                const it = document.createElement('div'); it.className = 'dial-item'; it.textContent = a; it.setAttribute('role', 'option'); it.dataset.value = a;
                track.appendChild(it);
            }
            // center the start age
            const idx = START_AGE - MIN_AGE;
            dialEl.scrollTop = idx * ITEM_TOTAL;

            const updateSel = () => {
                const idx = Math.round(dialEl.scrollTop / ITEM_TOTAL);
                const selAge = Math.min(MAX_AGE, Math.max(MIN_AGE, MIN_AGE + idx));
                [...dialEl.querySelectorAll('.dial-item')].forEach((el, i) => {
                    el.dataset.selected = (i === idx);
                    el.dataset.near = (Math.abs(i - idx) <= 1);
                    el.setAttribute('aria-selected', i === idx ? 'true' : 'false');
                });
                updateAges(selAge);

            };

            const snapToIdx = (idx) => {
                dialEl.scrollTo({ top: idx * ITEM_TOTAL, behavior: 'smooth' });
            };

            let scrollTimeout;
            dialEl.addEventListener('scroll', () => {
                updateSel();
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    const idx = Math.round(dialEl.scrollTop / ITEM_TOTAL);
                    snapToIdx(idx);
                }, 80);
            }, { passive: true });

            dialEl.addEventListener('keydown', (e) => {
                const idx = Math.round(dialEl.scrollTop / ITEM_TOTAL);
                if (e.key === 'ArrowUp') { e.preventDefault(); snapToIdx(Math.max(0, idx - 1)); }
                if (e.key === 'ArrowDown') { e.preventDefault(); snapToIdx(Math.min(MAX_AGE - MIN_AGE, idx + 1)); }
            });

            // allow click to jump
            dialEl.addEventListener('click', (e) => {
                const item = e.target.closest('.dial-item'); if (!item) return;
                const a = parseInt(item.dataset.value, 10);
                snapToIdx(a - MIN_AGE);
            });

            updateSel();
        })();

        /* ---------- Age text updates ---------- */
        function updateAges(currentAge) {
            document.querySelectorAll('.age-year').forEach(el => {
                const y = parseInt(el.getAttribute('data-year'), 10);
                const computed = Math.max(0, currentAge + (y - CURRENT_YEAR));
                el.textContent = computed;
            });
            // keep the document title in sync with the dial
            document.title = `I am ${currentAge} — How climate change will shape my life`;

            updateMortality(currentAge);
        }


        /* ---------- Reveal on scroll ---------- */
        const io = new IntersectionObserver(entries => {
            entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
        }, { threshold: .08 });
        document.querySelectorAll('.reveal').forEach(el => io.observe(el));

        /* ---------- Share / Print ---------- */
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 1600);
        }

        function setupShare(btnId) {
            const btn = document.getElementById(btnId);
            if (!btn) return;
            btn.addEventListener('click', async () => {
                try {
                    const shareData = { title: document.title, text: 'A life-scale climate overview worth sharing.', url: location.href };
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        await navigator.clipboard.writeText(location.href);
                        showToast('Link copied');
                    }
                } catch (e) {
                    await navigator.clipboard.writeText(location.href);
                    showToast('Link copied');
                }
            });
        }

        document.getElementById('printBtn')?.addEventListener('click', () => window.print());
        document.getElementById('printBtnBottom')?.addEventListener('click', () => window.print());
        setupShare('shareBtn');
        setupShare('shareBtnBottom');

        /* ---------- Scroll accent + position restore ---------- */
        setAccentByScroll();
        window.addEventListener('scroll', () => { setAccentByScroll(); sessionStorage.setItem('scrollY', String(window.scrollY)); }, { passive: true });
        window.addEventListener('load', () => {
            // restore position (same-tab revisit)
            const y = parseFloat(sessionStorage.getItem('scrollY') || '0');
            if (!isNaN(y)) window.scrollTo({ top: y, behavior: 'instant' });
        });

        /* ---------- Real-data charts ---------- */
        /* ---- Line animation helpers ---- */
        function resetPath(path) {
            const len = path.getTotalLength();
            path.style.transition = 'none';
            path.style.strokeDasharray = String(len);
            path.style.strokeDashoffset = String(len);
        }

        function animatePath(path, ms = 1600) {
            const len = path.getTotalLength();
            path.style.transition = 'none';
            path.style.strokeDasharray = String(len);
            path.style.strokeDashoffset = String(len);
            // reflow
            path.getBoundingClientRect();
            return new Promise(resolve => {
                const done = () => resolve();
                path.addEventListener('transitionend', done, { once: true });
                // safety timer in case 'transitionend' doesn't fire
                const t = setTimeout(done, ms + 60);
                path.addEventListener('transitionend', () => clearTimeout(t), { once: true });
                requestAnimationFrame(() => {
                    path.style.transition = `stroke-dashoffset ${ms}ms ease`;
                    path.style.strokeDashoffset = '0';
                });
            });
        }

        async function animateChartSequential(el) {
            const hist = el.querySelector('path[data-line="hist"]');
            const proj = el.querySelectorAll('path[data-line="proj"]');

            if (!hist) return;
            resetPath(hist);
            proj.forEach(p => resetPath(p));

            await animatePath(hist, 1600);     // when this finishes...
            await Promise.all([...proj].map(p => animatePath(p, 1200)));
        }

        /* Observe .chart containers and orchestrate sequential animation */
        const chartObserver = new IntersectionObserver(entries => {
            entries.forEach(e => {
                const paths = e.target.querySelectorAll('path[data-line]');
                if (!paths.length) return;
                if (e.isIntersecting) {
                    animateChartSequential(e.target);
                } else {
                    paths.forEach(p => resetPath(p));
                }
            });
        }, { threshold: 0.35 });

        function renderLine(elId, series, {
            fmtY = (v) => v.toFixed(2),
            yMin = null,
            yMax = null,
            projectionTo = null,      // numeric end year for this section
            scenario = null,          // <-- pass scenario series here (array of {x,y})
            monotonic = false,        // e.g., sea level true; temperatures false
            jaggedFactor = 0.6        // how “jagged” the dotted line looks
        } = {}) {
            const el = document.getElementById(elId); el.innerHTML = '';
            if (!series || series.length === 0) {
                el.innerHTML = '<div class="tiny muted">Data unavailable (CORS or offline). See Sources below.</div>';
                return;
            }

            const endY = projectionTo ?? endYearForChart(elId);
            const proj = (scenario && endY != null)
                ? buildScenarioProjection({ elId, hist: series, scenario, endYear: endY, monotonic, jaggedFactor })
                : [];

            // axes over both (avoid dup-ing last observed point)
            const combined = proj.length ? series.concat(proj.slice(1)) : series;

            const svg = mkSVG(); el.appendChild(svg);
            const W = 800, H = 450, PAD = 60; svg.setAttribute('viewBox', `0 0 ${W} ${H}`);

            const xs = combined.map(d => d.x), ys = combined.map(d => d.y);
            const minX = Math.min(...xs), maxX = Math.max(...xs);
            const minY = yMin !== null ? yMin : Math.min(...ys);
            const maxY = yMax !== null ? yMax : Math.max(...ys);

            const x = v => PAD + ((v - minX) / (maxX - minX)) * (W - 2 * PAD);
            const y = v => H - PAD - ((v - minY) / (maxY - minY)) * (H - 2 * PAD);

            // grid
            const g = document.createElementNS(svg.namespaceURI, 'g');
            g.setAttribute('stroke', '#e5e7eb'); g.setAttribute('stroke-width', '1'); g.setAttribute('fill', 'none');
            for (let i = 0; i < 6; i++) {
                const gy = y(minY + i * (maxY - minY) / 5);
                const ln = document.createElementNS(svg.namespaceURI, 'line');
                ln.setAttribute('x1', PAD); ln.setAttribute('x2', W - PAD);
                ln.setAttribute('y1', gy); ln.setAttribute('y2', gy);
                g.appendChild(ln);
            }
            svg.appendChild(g);

            // axes
            const axis = document.createElementNS(svg.namespaceURI, 'g');
            const ticks = (min, max, steps) => { const s = max - min, st = s / steps, t = []; for (let i = 0; i <= steps; i++)t.push(min + i * st); return t; };
            ticks(minX, maxX, 6).map(v => Math.round(v)).forEach(v => {
                const tx = document.createElementNS(svg.namespaceURI, 'text');
                tx.setAttribute('x', x(v)); tx.setAttribute('y', H - PAD + 24);
                tx.setAttribute('text-anchor', 'middle'); tx.setAttribute('font-size', '18'); tx.textContent = v;
                axis.appendChild(tx);
            });
            ticks(minY, maxY, 5).forEach(v => {
                const ty = document.createElementNS(svg.namespaceURI, 'text');
                ty.setAttribute('x', PAD - 10); ty.setAttribute('y', y(v) + 4);
                ty.setAttribute('text-anchor', 'end'); ty.setAttribute('font-size', '18'); ty.textContent = fmtY(v);
                axis.appendChild(ty);
            });
            svg.appendChild(axis);

            const toPath = pts => pts.map((p, i) => (i ? 'L' : 'M') + x(p.x) + ',' + y(p.y)).join(' ');

            // historical (solid)
            const hist = document.createElementNS(svg.namespaceURI, 'path');
            hist.setAttribute('d', toPath(series));
            hist.setAttribute('fill', 'none');
            hist.setAttribute('stroke', 'var(--accent)');
            hist.setAttribute('stroke-width', '3');
            hist.setAttribute('stroke-linecap', 'round');
            hist.setAttribute('data-line', 'hist');
            svg.appendChild(hist);

            // projection (grey dotted)
            if (proj.length >= 2) {
                const pth = document.createElementNS(svg.namespaceURI, 'path');
                pth.setAttribute('d', toPath(proj));
                pth.setAttribute('fill', 'none');
                pth.setAttribute('class', 'projection');
                pth.setAttribute('stroke', 'var(--proj)');
                pth.setAttribute('stroke-width', '3');
                pth.setAttribute('stroke-linecap', 'round');
                pth.setAttribute('stroke-dasharray', '6 6');
                pth.setAttribute('data-line', 'proj');
                svg.appendChild(pth);

                // add legend chip if missing
                const legend = el.closest('.card, .panel')?.querySelector('.legend');
                if (legend && !legend.querySelector('.key.proj')) {
                    const chip = document.createElement('span');
                    chip.className = 'swatch';
                    chip.innerHTML = '<span class="key proj"></span> Projection (likely)';
                    legend.appendChild(chip);
                }
            }

            // prep & animate sequentially when in view
            const r = el.getBoundingClientRect();
            chartObserver.observe(el);
            if (r.top < window.innerHeight * 0.8 && r.bottom > window.innerHeight * 0.2) {
                animateChartSequential(el);
            }
        }


        /* Data loaders with graceful fallback links in console */
        async function loadGISTEMP() {
            await withChartLoading('tempChart', async () => {   // <-- was 'slrChart'
                const data = await fetch('public/data/gistemp.json').then(r => r.json());
                const scen = await fetch('public/data/gistemp_scenario.json').then(r => r.json());
                const endY = endYearForChart('tempChart');        // -> 2029 in the 2025–2029 section
                renderLine('tempChart', data, {
                    fmtY: v => v.toFixed(2) + ' °C',
                    projectionTo: endY,
                    scenario: scen,
                    monotonic: false,
                    jaggedFactor: 0.5
                });
            });
        }


        async function loadSeaLevel() {
            await withChartLoading('slrChart', async () => {
                const data = await fetch('public/data/sealevel.json').then(r => r.json());
                const scen = await fetch('public/data/sealevel_scenario.json').then(r => r.json());
                const endY = endYearForChart('slrChart');            // -> 2039 for your 2030s section
                renderLine('slrChart', data, {
                    fmtY: v => nf0.format(v),
                    projectionTo: endY,
                    scenario: scen,
                    monotonic: false,
                    jaggedFactor: 2.0
                });
            });
        }

        const formatCO2Gt = vTonnes => nf1.format(vTonnes / 1e9) + ' Gt';

        async function loadCO2(targetId = 'co2Chart') {
            await withChartLoading(targetId, async () => {
                const data = await fetch('public/data/co2.json').then(r => r.json());
                const endY = endYearForChart(targetId);                 // -> 2049 in the 2040s block
                const scen = await fetch('public/data/co2_scenario.json').then(r => r.json());
                renderLine(targetId, data, {
                    fmtY: formatCO2Gt, yMin: 0,
                    projectionTo: endY,
                    scenario: scen,
                    monotonic: false,
                    jaggedFactor: 0.5
                });
            });
        }

        async function loadDisasterDamage(targetId = 'damageChart') {
            await withChartLoading(targetId, async () => {
                const data = await fetch('public/data/damages.json').then(r => r.json());
                const endY = endYearForChart(targetId);
                const scen = await fetch('public/data/damages_scenario.json').then(r => r.json());
                renderLine(targetId, data, {
                    fmtY: v => compactCurrency(v), yMin: 0,
                    projectionTo: endY,
                    scenario: scen,
                    jaggedFactor: 0.7
                });

            });
        }

        async function loadIDP(targetId = 'idpChart') {
            await withChartLoading(targetId, async () => {
                const data = await fetch('public/data/idp.json').then(r => r.json());
                const endY = endYearForChart(targetId);
                const scen = await fetch('public/data/idp_scenario.json').then(r => r.json());
                renderLine(targetId, data, {
                    fmtY: v => compact(v), yMin: 0,
                    projectionTo: endY,
                    scenario: scen,
                    jaggedFactor: 0.6
                });
            });
        }


        // Tab logic
        const tabButtons = [
            document.getElementById('tab-co2'),
            document.getElementById('tab-damage'),
            document.getElementById('tab-idp')
        ];
        const panels = {
            'tab-co2': document.getElementById('panel-co2'),
            'tab-damage': document.getElementById('panel-damage'),
            'tab-idp': document.getElementById('panel-idp')
        };
        const loaders = {
            'tab-co2': () => loadCO2('co2Chart'),
            'tab-damage': () => loadDisasterDamage('damageChart'),
            'tab-idp': () => loadIDP('idpChart')
        };
        const loadedOnce = new Set();

        function activateTab(id) {
            tabButtons.forEach(btn => btn.setAttribute('aria-selected', String(btn.id === id)));
            Object.entries(panels).forEach(([k, el]) => el.hidden = (k !== id));
            if (!loadedOnce.has(id)) { loaders[id](); loadedOnce.add(id); }
            panels[id].focus();
            const chartNow = panels[id].querySelector('.chart');
            const pathNow = chartNow?.querySelector('path');
            if (pathNow) { resetPath(pathNow); requestAnimationFrame(() => animatePath(pathNow)); }
        }

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => activateTab(btn.id));
            btn.addEventListener('keydown', (e) => {
                const idx = tabButtons.indexOf(btn);
                if (e.key === 'ArrowRight') { e.preventDefault(); activateTab(tabButtons[(idx + 1) % tabButtons.length].id); }
                if (e.key === 'ArrowLeft') { e.preventDefault(); activateTab(tabButtons[(idx - 1 + tabButtons.length) % tabButtons.length].id); }
            });
        });

        // Initial loads
        Promise.allSettled([
            loadGISTEMP().catch(() => { document.getElementById('tempChart').innerHTML = '<div class="tiny muted">Temperature data blocked (CORS/offline). <a class="inline" target="_blank" href="https://data.giss.nasa.gov/gistemp/">Open source</a>.</div>'; }),
            loadSeaLevel().catch(() => { document.getElementById('slrChart').innerHTML = '<div class="tiny muted">Sea-level data blocked (CORS/offline). <a class="inline" target="_blank" href="https://sealevel.nasa.gov/understanding-sea-level/key-indicators/global-mean-sea-level">Open source</a>.</div>'; })
        ]);
        // Load first tab by default
        activateTab('tab-co2');

        async function loadJSON(url, fallbackElId) {
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error('HTTP ' + res.status);
                return await res.json();
            } catch (err) {
                const el = document.getElementById(fallbackElId);
                el.innerHTML = '<div class="tiny muted">Data unavailable (' + err.message +
                    '). Check ' + url + ' exists and is same-origin.</div>';
                return null;
            }
        }

        function setChartLoading(elId, isLoading) {
            const el = document.getElementById(elId);
            if (!el) return;
            el.classList.toggle('loading', !!isLoading);
            el.setAttribute('aria-busy', String(!!isLoading));
            if (isLoading) el.innerHTML = ""; // clear before drawing; overlay handles the UI
        }

        async function withChartLoading(elId, work) {
            setChartLoading(elId, true);
            try { return await work(); }
            finally { setChartLoading(elId, false); }
        }

        (function fixScrollStart() {
            function navType() {
                // Modern
                const nav = performance.getEntriesByType && performance.getEntriesByType('navigation')[0];
                if (nav && nav.type) return nav.type; // 'navigate' | 'reload' | 'back_forward' | 'prerender'
                // Legacy fallback
                const t = performance.navigation && performance.navigation.type;
                return ({ 0: 'navigate', 1: 'reload', 2: 'back_forward', 255: 'navigate' })[t] || 'navigate';
            }

            function handle() {
                // Respect in-page anchors like /#timeline
                if (location.hash) return;

                const type = navType();
                if (type === 'back_forward') {
                    // Only case we restore the saved position
                    const y = parseFloat(sessionStorage.getItem('scrollY') || 'NaN');
                    if (!Number.isNaN(y)) window.scrollTo(0, y);
                } else {
                    // Fresh load or reload: go to top and clear any old value
                    sessionStorage.removeItem('scrollY');
                    window.scrollTo(0, 0);
                }
            }

            // Run after other load handlers so we can override earlier restores
            window.addEventListener('pageshow', handle);
            // Extra safety for browsers without 'pageshow'
            window.addEventListener('load', () => setTimeout(handle, 0));
        })();

        (function mobileTimelineFix() {
            const BREAKPOINT = 880; // matches your CSS intent

            // CSS overrides applied only when the class is present
            const css = `
  .mobile-timeline .timeline::before{
    left: 0.75rem !important;   /* rail on the left */
  }
  .mobile-timeline .t-row{
    grid-template-columns: 1fr !important;  /* stack year above panel */
    gap: 1.2rem !important;
    padding: 2rem 0 2rem 1.25rem !important; /* room for the rail */
  }
  .mobile-timeline .t-year{
    position: static !important;  /* disable sticky on phones */
    top: auto !important;
    margin: 0 !important;
  }
  .mobile-timeline .panel{
    margin: 0 !important;
  }

  /* Very small phones: tuck the rail a bit more */
  @media (max-width: 420px){
    .mobile-timeline .timeline::before{ left: 0.6rem !important; }
    .mobile-timeline .t-row{ padding-left: 1rem !important; }
  }

  /* Ultra-narrow fallback: if space is *really* tight, hide the rail */
  @media (max-width: 340px){
    .mobile-timeline .timeline::before{ display: none !important; }
    .mobile-timeline .t-row{ padding-left: 0 !important; }
  }`;

            // inject style once
            let tag = document.getElementById('mobile-timeline-fix');
            if (!tag) {
                tag = document.createElement('style');
                tag.id = 'mobile-timeline-fix';
                tag.textContent = css;
                document.head.appendChild(tag);
            }

            // toggle class based on viewport width and keep it in sync
            const root = document.documentElement;
            const mq = window.matchMedia(`(max-width:${BREAKPOINT}px)`);
            const apply = e => root.classList.toggle('mobile-timeline', e.matches);
            apply(mq);
            (mq.addEventListener ? mq.addEventListener('change', apply) : mq.addListener(apply));

            // also re-check on orientationchange (some browsers don't fire a media query change immediately)
            window.addEventListener('orientationchange', () => apply(mq), { passive: true });
        })();

        (function lockDialHorizontal() {
            // Inject minimal CSS to disable horizontal scroll and gestures
            const css = `
    #dial{
      overflow-x: hidden !important;
      touch-action: pan-y;           /* allow only vertical touch panning */
      overscroll-behavior-x: contain;/* stop sideways chaining */
    }
  `;
            let tag = document.getElementById('dial-lock-x-style');
            if (!tag) {
                tag = document.createElement('style');
                tag.id = 'dial-lock-x-style';
                tag.textContent = css;
                document.head.appendChild(tag);
            }

            const el = document.getElementById('dial');
            if (!el) return;

            // Keep scrollLeft pinned at 0 during momentum scrolls
            el.addEventListener('scroll', () => {
                if (el.scrollLeft !== 0) el.scrollLeft = 0;
            }, { passive: true });

            // On touchpads: block horizontal wheel deltas
            el.addEventListener('wheel', (e) => {
                if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {
                    e.preventDefault();
                    el.scrollLeft = 0;
                }
            }, { passive: false });

            // Safety: if something sets scrollLeft later, zero it out
            const ro = new ResizeObserver(() => { el.scrollLeft = 0; });
            ro.observe(el);
        })();


        function ensureDeathMarker() {
            if (deathMarkerEl) return deathMarkerEl;
            deathMarkerEl = document.createElement('div');
            deathMarkerEl.id = 'deathMarker';
            deathMarkerEl.className = 'death-marker';
            deathMarkerEl.innerHTML = `<span class="label tiny">
    <i class="fa-solid fa-skull"></i> eventually, every timeline ends
  </span>`;
            return deathMarkerEl;
        }

        /* pick a representative year for each row (max data-year in its .t-year) */
        function rowYear(row) {
            let y = -Infinity;
            row.querySelectorAll('.age-year').forEach(s => {
                const v = parseInt(s.getAttribute('data-year'), 10);
                if (!Number.isNaN(v)) y = Math.max(y, v);
            });
            return Number.isFinite(y) ? y : CURRENT_YEAR;
        }

        /* create/update/remove a small appended note on a row's .t-year */
        function upsertLifeNote(row, html) {
            const host = row.querySelector('.t-year');
            if (!host) return;
            let note = host.querySelector('.life-note');
            if (!html) {
                if (note) note.remove();
                return;
            }
            if (!note) {
                note = document.createElement('p');
                note.className = 'life-note muted';   // <- match the built-in style
                host.appendChild(note);
            } else {
                // ensure class remains correct if something else touched it
                note.className = 'life-note muted';
            }
            note.innerHTML = html;
        }


        function toggleAgeLines(row, post) {
            const ps = row.querySelectorAll('.t-year .muted');
            ps.forEach(p => {
                const isLifeNote = p.classList.contains('life-note');
                if (isLifeNote) return; // never hide our appended note

                const txt = (p.textContent || "");
                const hasAgeSpan = p.querySelector('.age-year') !== null;
                const isReachIt = /if you reach it/i.test(txt);

                const shouldHide = post && (isReachIt || hasAgeSpan);
                if (shouldHide) {
                    if (!p.dataset.mortalityHidden) {
                        p.style.display = 'none';
                        p.dataset.mortalityHidden = '1';
                    }
                } else if (p.dataset.mortalityHidden) {
                    p.style.display = '';
                    delete p.dataset.mortalityHidden;
                }
            });
        }

        /* place marker, toggle dotted rail, append kids/grandkids note — year not bolded */
        function updateMortality(currentAge) {
            const deathYear = CURRENT_YEAR + (DEATH_AGE - currentAge);
            const rows = Array.from(timelineEl.querySelectorAll(':scope > .t-row'));

            const marker = ensureDeathMarker();
            marker.remove();
            let insertBefore = null;
            for (const r of rows) {
                if (rowYear(r) > deathYear) { insertBefore = r; break; }
            }
            if (insertBefore) timelineEl.insertBefore(marker, insertBefore);
            else timelineEl.appendChild(marker);

            // reset any previous "first-post" state
            rows.forEach(r => {
                r.classList.remove('first-post');
                r.style.removeProperty('--death-offset');
            });

            // if we have a first post-life row, extend its overlay up to the marker center
            if (insertBefore) {
                const markerRect = marker.getBoundingClientRect();
                const rowRect = insertBefore.getBoundingClientRect();
                const markerCenter = markerRect.top + (markerRect.height / 2);
                const gap = Math.max(0, rowRect.top - markerCenter);        // pixels from marker line to row top
                insertBefore.classList.add('first-post');
                insertBefore.style.setProperty('--death-offset', gap + 'px');
            }

            // update each row
            rows.forEach(r => {
                const y = rowYear(r);
                const post = y > deathYear;
                r.classList.toggle('post-life', post);

                toggleAgeLines(r, post);

                if (!post) {
                    // remove any previously appended life-note
                    upsertLifeNote(r, "");
                    return;
                }

                // compute ages at this row's year
                const youAtY = Math.max(0, currentAge + (y - CURRENT_YEAR));
                const kidAtY = Math.max(0, youAtY - GENERATION);
                const gkidAtY = Math.max(0, kidAtY - GENERATION);
                const delta = y - deathYear;

                // build message: ages bold, year NOT bold
                let msg;
                if (delta <= GENERATION) {
                    msg = `You are already gone. But your kids would be roughly <strong>${nf0.format(kidAtY)}</strong> in ${y}.`;
                } else if (delta <= 2 * GENERATION) {
                    msg = `You and your kids are already gone. But your grandkids would be roughly <strong>${nf0.format(gkidAtY)}</strong> in ${y}.`;
                } else {
                    msg = `You, your kids, and your grandkids are already gone by ${y}.`;
                }
                upsertLifeNote(r, msg);
            });
        }

        function endYearForChart(elId) {
            const el = document.getElementById(elId);
            if (!el) return null;
            const row = el.closest('.t-row');
            if (!row) return null;
            return rowYear(row); // you already wrote this helper
        }

        /* least-squares linear regression on the last N points */
        function linearRegression(points, useLastN = 10) {
            const data = points.slice(Math.max(0, points.length - useLastN));
            const n = data.length;
            if (n < 2) {
                const last = data[n - 1] || { x: 0, y: 0 };
                return { m: 0, b: last.y };
            }
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            for (const d of data) {
                sumX += d.x; sumY += d.y;
                sumXY += d.x * d.y; sumXX += d.x * d.x;
            }
            const denom = n * sumXX - sumX * sumX;
            const m = denom !== 0 ? (n * sumXY - sumX * sumY) / denom : 0;
            const b = (sumY - m * sumX) / n;
            return { m, b };
        }

        /* Build projected series up to targetYear, starting from last observed point */
        function buildProjection(series, targetYear, { useLastN = 10 } = {}) {
            if (!series?.length || targetYear == null) return [];
            const last = series[series.length - 1];
            if (targetYear <= last.x) return []; // nothing to project into the future

            const { m, b } = linearRegression(series, useLastN);
            const proj = [];
            // include the last real point so the dotted line connects cleanly
            proj.push({ x: last.x, y: last.y });

            // assume annual spacing; adjust here if your data are monthly
            for (let x = Math.floor(last.x) + 1; x <= targetYear; x++) {
                proj.push({ x, y: m * x + b });
            }
            return proj;
        }

        function endYearForChart(elId) {
            const el = document.getElementById(elId);
            const row = el?.closest('.t-row');
            return row ? rowYear(row) : null; // you already have rowYear(...)
        }

        /* Infer typical x-step (handles monthly vs yearly) using median Δx */
        function inferStep(series) {
            if (!series || series.length < 2) return 1;
            const diffs = [];
            for (let i = 1; i < series.length; i++) {
                const dx = series[i].x - series[i - 1].x;
                if (Number.isFinite(dx) && dx > 0) diffs.push(dx);
            }
            if (!diffs.length) return 1;
            diffs.sort((a, b) => a - b);
            return diffs[Math.floor(diffs.length / 2)];
        }

        /* Least-squares fit over the last `windowYears` of data */
        function linearRegressionByWindow(series, windowYears = 10) {
            if (!series?.length) return { m: 0, b: 0 };
            const lastX = series[series.length - 1].x;
            const data = series.filter(d => d.x >= lastX - windowYears);
            const n = data.length;
            if (n < 2) {
                const last = data[n - 1] || series[series.length - 1];
                return { m: 0, b: last?.y ?? 0 };
            }
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            for (const d of data) { sumX += d.x; sumY += d.y; sumXY += d.x * d.y; sumXX += d.x * d.x; }
            const denom = n * sumXX - sumX * sumX;
            const m = denom !== 0 ? (n * sumXY - sumX * sumY) / denom : 0;
            const b = (sumY - m * sumX) / n;
            return { m, b };
        }

        /* Build projection at the same cadence so it connects cleanly */
        function buildProjection(series, targetYear, { windowYears = 10 } = {}) {
            if (!series?.length || targetYear == null) return [];
            const last = series[series.length - 1];
            if (targetYear <= last.x) return [];
            const step = inferStep(series);        // e.g., ~0.0833 for monthly, 1 for yearly
            const { m, b } = linearRegressionByWindow(series, windowYears);

            const proj = [];
            // include the last real point so the dotted line starts exactly there
            proj.push({ x: last.x, y: last.y });

            // step forward at the same cadence
            for (let x = last.x + step; x <= targetYear + 1e-9; x += step) {
                proj.push({ x, y: m * x + b });
            }
            return proj;
        }

        function endYearForChart(elId) {
            const el = document.getElementById(elId);
            const row = el?.closest('.t-row');
            return row ? rowYear(row) : null;
        }

        /* Median Δx (months vs years) */
        function inferStep(series) {
            if (!series || series.length < 2) return 1;
            const diffs = [];
            for (let i = 1; i < series.length; i++) {
                const dx = series[i].x - series[i - 1].x;
                if (Number.isFinite(dx) && dx > 0) diffs.push(dx);
            }
            diffs.sort((a, b) => a - b);
            return diffs.length ? diffs[Math.floor(diffs.length / 2)] : 1;
        }

        /* Median absolute per-step Δy (used to size the “jagged” wiggle) */
        function medianAbsStep(series) {
            if (!series || series.length < 2) return 0;
            const diffs = [];
            for (let i = 1; i < series.length; i++) {
                diffs.push(Math.abs(series[i].y - series[i - 1].y));
            }
            diffs.sort((a, b) => a - b);
            return diffs[Math.floor(diffs.length / 2)] || 0;
        }

        /* Tiny deterministic RNG so the jagged line is stable between renders */
        function mulberry32(a) {
            return function () {
                let t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296;
            };
        }
        function seedFrom(elId) { // simple, stable seed
            let s = 2166136261; for (const c of (elId || "")) { s ^= c.charCodeAt(0); s = Math.imul(s, 16777619); }
            return s >>> 0;
        }

        /* Linear interpolation on an (x,y) series */
        function interpY(series, x) {
            if (!series?.length) return 0;
            if (x <= series[0].x) return series[0].y;
            if (x >= series[series.length - 1].x) return series[series.length - 1].y;
            let lo = 0, hi = series.length - 1;
            while (hi - lo > 1) {
                const mid = (lo + hi) >> 1;
                if (series[mid].x <= x) lo = mid; else hi = mid;
            }
            const a = series[lo], b = series[hi];
            const t = (x - a.x) / (b.x - a.x);
            return a.y + t * (b.y - a.y);
        }

        /* Resample a scenario onto the historical cadence, add a small jagged wiggle, clamp if needed */
        function buildScenarioProjection({ elId, hist, scenario, endYear, monotonic = false, jaggedFactor = 0.6 }) {
            if (!hist?.length || !scenario?.length || endYear == null) return [];
            const last = hist[hist.length - 1];
            if (endYear <= last.x) return [];

            const step = inferStep(hist);               // monthly (~0.0833) or yearly (1)
            const baseAmp = medianAbsStep(hist) || 0;   // typical wiggle from your real data
            const amp = baseAmp * jaggedFactor;
            const rng = mulberry32(seedFrom(elId));

            const proj = [{ x: last.x, y: last.y }];
            let prevY = last.y;

            for (let x = last.x + step; x <= endYear + 1e-9; x += step) {
                const scenNext = interpY(scenario, x);
                const jitter = (rng() * 2 - 1) * amp;

                if (monotonic) {
                    // keep it increasing but let the *step size* wiggle
                    const scenStep = Math.max(0, scenNext - prevY);           // scenario’s forward push
                    const noisyStep = Math.max(0, scenStep + jitter);          // allow wiggle but not negative
                    const minStep = Math.max(amp * 0.10, scenStep * 0.30);   // avoid flat segments
                    const delta = Math.max(noisyStep, minStep);
                    const y = prevY + delta;
                    proj.push({ x, y }); prevY = y;
                } else {
                    let y = scenNext + jitter;
                    proj.push({ x, y }); prevY = y;
                }
            }
            return proj;
        }

    </script>
</body>

</html>